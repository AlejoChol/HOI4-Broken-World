add_namespace = rmap


country_event = { 
	id = rmap.0
	title = rmap.0.t
	desc = rmap.0.d
	picture = GFX_report_event_generic_sign_treaty2
	is_triggered_only = yes
	option = {
		name = rmap.0.a
		hidden_effect = {
			country_event = { id = rmap.1 }
		}
	}
}

country_event = { 
	id = rmap.2
	fire_only_once = no
	hidden = yes
	is_triggered_only = yes
	immediate = {
	 	every_possible_country = { every_core_state = { remove_core_of = PREV } }  every_owned_state = {limit = {has_state_flag = rmap_owned} every_neighbor_state = {limit = {NOT = {has_state_flag = rmap_owned} NOT = {is_core_of = ROOT}} set_state_flag = rmap_owned ROOT = {transfer_state = PREV} add_core_of = PREV}}
	every_state = { set_demilitarized_zone = no } 
	every_possible_country = { every_state = { remove_claim_by = PREV } }
	 			
	
	
	
	
 } } 
	

	
country_event = { 
	id = rmap.1
	fire_only_once = yes
	hidden = yes
	is_triggered_only = yes
	immediate = {
	every_state = {remove_core_of = OWNER}
	# We distribute at least 1 country per landmass
	## Europe
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved}
				is_on_continent = europe 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 

	## Africa
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				is_on_continent = africa 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 
	
	## Asia
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				is_on_continent = asia 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 1} 
			set_state_flag = capital_@PREV
		} } 
	## South America
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				is_on_continent = south_america 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 
	## Middle East
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				is_on_continent = middle_east 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 
	## Africa
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				is_on_continent = north_america 
				is_island_state = no} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 
	## Home Islands
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				region = 154} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV} } 
	## Australia
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				region = 156 
				NOT = {state = 518}} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
	} } 
	## Philipines
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				region = 160 
				NOT = {state = 626}} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 3} 
			set_state_flag = capital_@PREV
	} } 
	## Great Britain
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				OR = {region = 1 region = 2 region = 3}} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV} } 
	## Ireland
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				OR = { region = 4 state = 119 }} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
	} } 
	## Iberia
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = {has_state_flag = rmap_reserved} 
				region = 41} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		} } 


	
	# Distribute random capital states for every country left
	every_country = {
		limit = { NOT = { has_country_flag = rmap_ctr } }
		random_state = {
			limit = {NOT = {has_state_flag = rmap_owned}} 
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = {	state = PREV}
				goto_state = PREV} 
			add_core_of = PREV 
			add_manpower = 250000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
		set_state_flag = capital_@PREV
	} }
	
	# Give each country its neighbouring states, in 4 loops (so as to give less advantage to lower IDs in the list)
	every_country = {
		country_event = {id = rmap.2} } 
		
	every_country = {
		country_event = {id = rmap.2} } 
		
	every_country = {
		country_event = {id = rmap.2} } 
		
	every_country = {
		country_event = {id = rmap.2} 
		
		random_list = { 
			1={add_popularity = {ideology = fascism popularity = 0.25} set_politics = { ruling_party = fascism } }
			1={add_popularity = {ideology = communism popularity = 0.25} set_politics = { ruling_party = communism } }
			1={add_popularity = {ideology = democratic popularity = 0.25} set_politics = { ruling_party = democratic elections_allowed = yes election_frequency = 48}}
			1={add_popularity = {ideology = neutrality popularity = 0.25} set_politics = { ruling_party = neutrality }}
		}
		
		#Necessary as the game doesn't update tag for some reason
		set_cosmetic_tag = D99
		drop_cosmetic_tag = yes
	}

	every_state = {
		limit = {NOT =  {has_state_flag = rmap_owned is_owned_by = JAN}} 
		if = {
			limit = {is_island_state = yes }
			random_country = {
				limit = {
					any_owned_state = {
						OR = {is_coastal = yes is_island_state = yes } 
						has_state_flag = rmap_owned
					}
				}
				transfer_state = PREV
				PREV = {set_state_flag = rmap_owned}
			}
		}
		else_if = {
			limit = {is_coastal = yes}
			random_list={
				1={
					random_country = {
						limit = {
							any_owned_state = {
								OR = {is_coastal = yes is_island_state = yes } 
								has_state_flag = rmap_owned
							}
						} 
						transfer_state = PREV
						PREV = {set_state_flag = rmap_owned}
					}
				}
				3={
					transfer_state_to = JAN
					while_loop_effect = {
						limit = {has_state_flag = rmap_owned}
						JAN = {
							every_owned_state = {
								limit = {NOT = {has_state_flag = rmap_owned}}
								every_neighbor_state = {
									if = { 
										limit = {has_state_flag = rmap_owned}
										owner = {
											JAN = {
												every_owned_state = {limit = {NOT = {has_state_flag = rmap_owned}} set_state_flag = rmap_owned}}
											annex_country = {target = JAN}
										}
									}
									else = {transfer_state_to = JAN}
								}
							}
						}
					}
				}
			}
		}
		else = {
			transfer_state_to = JAN
			while_loop_effect = {
				limit = {has_state_flag = rmap_owned}
				JAN = {
					every_core_state = {
						every_neighbor_state = {
							if = { 
								limit = {has_state_flag = rmap_owned}
								owner = {
									JAN = {
										every_owned_state = {limit = {NOT = {has_state_flag = rmap_owned}} set_state_flag = rmap_owned}}
									annex_country = {target = JAN}
								}
							}
							else = {transfer_state_to = JAN}
						}
					}
				}
			}
		}

	}
	
	#Randomize states' stats
	every_state = {

		# Randomize manpower
		if = { limit = { is_island_state = no }
			random_list = {
				45 = {add_manpower = 250000} 
				25 = {add_manpower = 500000} 
				15 = {add_manpower = 900000} 
				12 = {add_manpower = 1600000} 
				3 = {add_manpower = 2800000}
			}
			random_list = {
				45 = {add_manpower = 250000} 
				25 = {add_manpower = 500000} 
				15 = {add_manpower = 900000} 
				12 = {add_manpower = 1600000} 
				3 = {add_manpower = 2800000}
			}
			random_list = {
				45 = {add_manpower = 250000} 
				25 = {add_manpower = 500000} 
				15 = {add_manpower = 900000} 
				12 = {add_manpower = 1600000} 
				3 = {add_manpower = 2800000}
			}
			if = {limit = {is_coastal = yes} 
				30 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 20 }}}
				20 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 15 }}}
				15 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 10 }}}
			}
			else = {
				random_list = {
					15 = {add_manpower = 80000} 
					20 = {add_manpower = 160000} 
					30 = {add_manpower = 350000} 
					20 = {add_manpower = 700000} 
					15 = {add_manpower = 950000}
				}
				random_list = {
					15 = {add_manpower = 80000} 
					20 = {add_manpower = 160000} 
					30 = {add_manpower = 350000} 
					20 = {add_manpower = 700000} 
					15 = {add_manpower = 950000}
				}
				random_list = {
					15 = {add_manpower = 80000} 
					20 = {add_manpower = 160000} 
					30 = {add_manpower = 350000} 
					20 = {add_manpower = 700000} 
					15 = {add_manpower = 950000}
				}
				random_list = {
					30 = {}
					20 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 2 }}}
					15 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 4 }}}
				}
			}
		}
		else = { 
			random_list = {
				45 = {add_manpower = 25000} 
				25 = {add_manpower = 50000} 
				15 = {add_manpower = 90000} 
				12 = {add_manpower = 160000} 
				3 = {add_manpower = 280000}
			}
			random_list = {
				30 = {}
				20 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 4 }}}
				15 = {OWNER = {add_equipment_to_stockpile = { type = convoy_1 amount = 8 }}}
			}
		}

		
		
		random_list = { 2 = {} 1 = {set_building_level={type = industrial_complex level = 1}}}
		random_list = { 3 = {} 1 = {set_building_level={type = arms_factory level = 2}}}
		if = {limit = { OR = {is_coastal = yes is_island_state = yes } } 
			random_list = { 2 = {} 1 = {set_building_level={type = dockyard level = 1}}}
		}

		random_list = { 5 = {} 1 = {set_building_level={type = air_base level = 1}}}
		
		#


		random_list = { 
		# 32={}
			1={
				set_state_category = wasteland 
				set_building_level ={type = infrastructure level = 1}
			}
			8={
				set_state_category = pastoral 
				random_list={
					4={set_building_level ={type = infrastructure level = 1}}
					8={set_building_level ={type = infrastructure level = 2}}
					2={set_building_level ={type = infrastructure level = 3}}
				}
			}
			16={
				set_state_category = rural
				random_list={
					4={set_building_level ={type = infrastructure level = 1}}
					8={set_building_level ={type = infrastructure level = 2}}
					2={set_building_level ={type = infrastructure level = 3}}
				}
			}
			32={
				set_state_category = town
				random_list={
					2={set_building_level ={type = infrastructure level = 2}}
					4={set_building_level ={type = infrastructure level = 3}}
					8={set_building_level ={type = infrastructure level = 4}}
				}
			}
			16={
				set_state_category = large_town
				random_list={
					8={set_building_level ={type = infrastructure level = 3}}
					1={set_building_level ={type = infrastructure level = 4}}
				}
			}
			8={
				set_state_category = city
				random_list={
					8={set_building_level ={type = infrastructure level = 3}}
					4={set_building_level ={type = infrastructure level = 4}}
				}
			}
			4={
				set_state_category = large_city
				random_list={
					8={set_building_level ={type = infrastructure level = 3}}
					8={set_building_level ={type = infrastructure level = 4}}
				}
			}
			2={
				set_state_category = metropolis
				random_list={
					8={set_building_level ={type = infrastructure level = 3}}
					16={set_building_level ={type = infrastructure level = 4}}
				}
			}
			1={
				set_state_category = megalopolis
			}
		}


		OWNER = {add_equipment_to_stockpile = {type = infantry_equipment_0 amount = 750}}
	}


	every_country = {
			limit = {
				any_owned_state = {
					NOT = {is_core_of = PREV}
				}
			}
			every_owned_state = {
				limit = {
					NOT = {is_core_of = PREV}
				}
				add_core_of = PREV
			}
		}
	}
}

